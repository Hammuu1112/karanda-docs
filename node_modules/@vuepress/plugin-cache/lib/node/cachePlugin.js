import ci from 'ci-info';
import { highlightCache } from './highlightCache.js';
import { renderCacheWithFilesystem, renderCacheWithMemory, } from './renderCache.js';
/**
 * Cache markdown rendering, optimize compilation speed.
 *
 * This plugin is recommended to be placed after all other plugins to ensure maximum utilization of the cache.
 */
export const cachePlugin = ({ type, enableInCi = false, } = {}) => {
    const plugin = {
        name: '@vuepress/plugin-cache',
    };
    if (ci.isCI && !enableInCi) {
        return plugin;
    }
    return {
        ...plugin,
        async extendsMarkdown(md, app) {
            highlightCache(md, app);
            if (type === 'filesystem') {
                await renderCacheWithFilesystem(md, app);
            }
            else {
                await renderCacheWithMemory(md, app);
            }
        },
    };
};
